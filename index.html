<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>mYpuB - Gestión de Archivos Multimedia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CSS & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: #f7f7f9; }
        .file-card { transition: box-shadow 0.2s; }
        .file-card:hover { box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.07); }
        #mainPanel, #galleryModule, #foldersModule, #shareModule, #usersModule, #activityModule { display: none; }
        .password-strength { height: 4px; width: 100%; background:#eee; border-radius:2px; margin-top:4px; }
        .strength-1 { background: #dc3545; }
        .strength-2 { background: #ffc107; }
        .strength-3 { background: #0d6efd; }
        .strength-4 { background: #198754; }
        #helpPanel, #helpOverlay { display:none; position:fixed; z-index:1099; }
        #helpPanel { right:0; top:0; width:340px; background:#fff; height:100%; box-shadow:-2px 0 8px rgba(0,0,0,.07);}
        #helpOverlay { left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.18);}
        #notifPanel { position:absolute; right:0; top:42px; background:#fff; width:320px; max-height:400px; overflow:auto; border-radius:6px; box-shadow:0 4px 16px rgba(0,0,0,0.18); display:none; z-index:1202;}
        #notifIcon:hover + #notifPanel, #notifPanel:hover { display:block; }
        .main-nav-link.active { font-weight: bold; border-bottom: 2px solid #0d6efd; }
        .avatar-sm { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; }
        .avatar-xs { width: 20px; height: 20px; border-radius: 50%; object-fit: cover; }
        .list-group-item { border: none; }
    </style>
</head>
<body>
<div class="container-fluid py-2">
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm rounded mb-3 px-2">
        <a class="navbar-brand me-3" href="#"><i class="bi bi-camera2 text-primary"></i> <b>mYpuB</b></a>
        <ul class="navbar-nav flex-row flex-wrap gap-2 me-auto" id="mainNav" style="display:none;">
            <li><button class="btn btn-link main-nav-link" data-module="gallery">Galería</button></li>
            <li><button class="btn btn-link main-nav-link" data-module="folders">Carpetas</button></li>
            <li><button class="btn btn-link main-nav-link" data-module="share">Compartidos</button></li>
            <li><button class="btn btn-link main-nav-link" data-module="activity">Actividad</button></li>
            <li id="navUsers" style="display:none;"><button class="btn btn-link main-nav-link" data-module="users">Gestión</button></li>
        </ul>
        <ul class="navbar-nav ms-auto align-items-center gap-2" id="userNav" style="display:none;">
            <li>
                <span id="notifIcon" style="cursor:pointer;position:relative;">
                    <i class="bi bi-bell"></i>
                </span>
                <div id="notifPanel"></div>
            </li>
            <li>
                <img id="userAvatar" src="default-avatar.png" class="avatar-sm border" alt="avatar" style="cursor:pointer;">
            </li>
            <li>
                <span class="d-none d-md-inline" id="userNameNav"></span>
            </li>
            <li>
                <button class="btn btn-link text-danger" id="logoutBtn" title="Cerrar sesión"><i class="bi bi-box-arrow-right"></i></button>
            </li>
        </ul>
    </nav>

    <!-- AUTENTICACIÓN -->
    <div id="authPanel">
        <div class="row justify-content-center">
            <div class="col-md-5">
                <div class="card shadow-sm">
                    <div class="card-header bg-light d-flex">
                        <button id="loginTabBtn" class="btn btn-link flex-fill active">Iniciar sesión</button>
                        <button id="registerTabBtn" class="btn btn-link flex-fill">Registrarse</button>
                    </div>
                    <div class="card-body">
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="loginEmail" class="form-label">Correo electrónico</label>
                                <input type="email" class="form-control" id="loginEmail" required>
                            </div>
                            <div class="mb-3">
                                <label for="loginPassword" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="loginPassword" required>
                            </div>
                            <div class="mb-3 text-end">
                                <button type="button" id="helpBtnLogin" class="btn btn-sm btn-link">¿Necesitas ayuda?</button>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Entrar</button>
                            <div class="mt-3 small text-center">
                                ¿No tienes cuenta? <a href="#" id="toRegisterLink">Regístrate</a>
                            </div>
                        </form>
                        <form id="registerForm" style="display:none;">
                            <div class="mb-2">
                                <label class="form-label">Nombre completo</label>
                                <input type="text" class="form-control" id="fullName" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Correo Gmail</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Género</label>
                                <select class="form-select" id="gender" required>
                                    <option value="">Selecciona</option>
                                    <option value="M">Masculino</option>
                                    <option value="F">Femenino</option>
                                    <option value="O">Otro</option>
                                </select>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">País</label>
                                <select class="form-select" id="country" required></select>
                            </div>
                            <div class="mb-2 input-group">
                                <span class="input-group-text">+</span>
                                <input type="text" class="form-control" id="phone" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="password" required>
                                <div class="password-strength" id="passwordStrength"></div>
                                <div id="passwordHelp" class="form-text"></div>
                            </div>
                            <div class="mb-2 form-check">
                                <input class="form-check-input" type="checkbox" id="termsCheck" required>
                                <label class="form-check-label" for="termsCheck">Acepto los términos y condiciones</label>
                            </div>
                            <div class="mb-3 text-end">
                                <button type="button" id="helpBtnRegister" class="btn btn-sm btn-link">¿Necesitas ayuda?</button>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Registrarse</button>
                            <div class="mt-3 small text-center">
                                ¿Ya tienes cuenta? <a href="#" id="toLoginLink">Inicia sesión</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PANEL PRINCIPAL -->
    <div id="mainPanel">
        <!-- Galería -->
        <div id="galleryModule">
            <div class="d-flex mb-3 align-items-center gap-2">
                <input type="file" id="fileInput" multiple accept="image/*,video/*" class="form-control form-control-sm" style="max-width:230px;">
                <select class="form-select form-select-sm" id="fileVisibility" style="max-width:110px;">
                    <option value="public">Público</option>
                    <option value="private">Privado</option>
                </select>
                <button class="btn btn-sm btn-outline-secondary" id="createFolderBtn"><i class="bi bi-folder-plus"></i> Nueva carpeta</button>
                <input type="text" class="form-control form-control-sm ms-auto" id="gallerySearch" placeholder="Buscar archivos..." style="max-width:200px;">
                <button id="searchBtn" class="btn btn-outline-primary btn-sm"><i class="bi bi-search"></i></button>
            </div>
            <div id="userFolders" class="mb-2"></div>
            <div class="row" id="galleryFiles"></div>
        </div>

        <!-- Carpetas -->
        <div id="foldersModule">
            <div class="mb-3 d-flex align-items-center">
                <button class="btn btn-primary btn-sm" id="createFolderBtn2"><i class="bi bi-folder-plus"></i> Crear carpeta</button>
            </div>
            <div id="foldersList"></div>
        </div>

        <!-- Compartidos -->
        <div id="shareModule">
            <div class="mb-3">
                <h5>Archivos que te han compartido</h5>
                <table class="table table-sm table-hover" id="sharedFilesTable">
                    <thead>
                        <tr>
                            <th>Nombre</th><th>Remitente</th><th>Fecha</th><th>Acción</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Actividad -->
        <div id="activityModule">
            <h5>Mi actividad</h5>
            <div id="activityLogPanel" class="mt-3"></div>
        </div>

        <!-- Gestión de usuarios (solo desarrollador) -->
        <div id="usersModule">
            <h5>Gestión de usuarios</h5>
            <table class="table table-sm table-hover" id="usersTable">
                <thead>
                    <tr>
                        <th>Nombre</th><th>Correo</th><th>País</th><th>Teléfono</th><th>Estado</th><th>Acción</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<!-- MODAL: Ver archivo (imagen/video, comentarios, like, compartir, eliminar) -->
<div class="modal fade" id="fileModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fileModalTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="fileModalContent"></div>
            <div class="modal-footer d-flex align-items-center gap-2">
                <span id="fileOwner"></span>
                <span id="fileDate"></span>
                <span class="ms-auto">
                    <span id="fileLikesCount" class="badge bg-primary"></span>
                    <button class="btn btn-sm btn-outline-primary" id="likeBtn"><i class="bi bi-hand-thumbs-up"></i></button>
                </span>
                <button class="btn btn-sm btn-outline-success" id="downloadBtn"><i class="bi bi-download"></i></button>
                <button class="btn btn-sm btn-outline-secondary" id="shareBtn"><i class="bi bi-share"></i></button>
                <button class="btn btn-sm btn-outline-danger" id="deleteBtn"><i class="bi bi-trash"></i></button>
            </div>
        </div>
    </div>
</div>
<!-- MODAL: Crear/editar carpeta -->
<div class="modal fade" id="folderModal" tabindex="-1">
    <div class="modal-dialog">
        <form class="modal-content" id="folderForm">
            <div class="modal-header">
                <h5 class="modal-title">Nueva carpeta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="text" class="form-control mb-2" id="folderName" placeholder="Nombre de la carpeta" required>
                <select class="form-select" id="folderVisibility">
                    <option value="public">Pública</option>
                    <option value="private">Privada</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
        </form>
    </div>
</div>
<!-- MODAL: Compartir archivo -->
<div class="modal fade" id="shareModal" tabindex="-1">
    <div class="modal-dialog">
        <form class="modal-content" id="shareForm">
            <div class="modal-header">
                <h5 class="modal-title">Compartir archivo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="shareFileId">
                <label>Correo del usuario</label>
                <input type="email" class="form-control" id="shareEmail" required placeholder="Correo del usuario">
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Compartir</button>
            </div>
        </form>
    </div>
</div>
<!-- MODAL: Perfil de usuario -->
<div class="modal fade" id="profileModal" tabindex="-1">
    <div class="modal-dialog">
        <form class="modal-content" id="profileForm">
            <div class="modal-header">
                <h5 class="modal-title">Mi perfil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2 text-center">
                    <img src="default-avatar.png" class="avatar-sm border" id="profileAvatarPreview" alt="Avatar">
                </div>
                <div class="mb-2">
                    <input type="file" class="form-control" id="profileAvatar" accept="image/*">
                </div>
                <div class="mb-2">
                    <label>Nombre</label>
                    <input type="text" class="form-control" id="profileName" required>
                </div>
                <div class="mb-2">
                    <label>País</label>
                    <input type="text" class="form-control" id="profileCountry" required>
                </div>
                <div class="mb-2">
                    <label>Teléfono</label>
                    <input type="text" class="form-control" id="profilePhone" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Guardar cambios</button>
            </div>
        </form>
    </div>
</div>
<!-- MODAL: Confirmación -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title" id="confirmModalTitle"></h5></div>
            <div class="modal-body" id="confirmModalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button class="btn btn-danger" id="confirmActionBtn">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<!-- PANEL DE AYUDA -->
<div id="helpOverlay"></div>
<div id="helpPanel">
    <div class="p-3 border-bottom d-flex align-items-center justify-content-between">
        <span><i class="bi bi-question-circle"></i> Ayuda & Contacto</span>
        <button class="btn btn-link" id="closeHelpBtn"><i class="bi bi-x-lg"></i></button>
    </div>
    <div class="p-3">
        <h6>¿Necesitas ayuda?</h6>
        <form id="emailHelpForm" class="mb-3">
            <input type="text" class="form-control mb-2" id="helpName" placeholder="Tu nombre" required>
            <button class="btn btn-outline-primary w-100">Contactar por Email</button>
        </form>
        <form id="whatsappHelpForm">
            <input type="text" class="form-control mb-2" id="helpWhatsappName" placeholder="Tu nombre" required>
            <button class="btn btn-outline-success w-100">Contactar por WhatsApp</button>
        </form>
    </div>
    <div class="p-3 border-top small text-muted">
        También puedes escribir a <b>soporte@tudominio.com</b> o WhatsApp <b>+1234567890</b>
    </div>
</div>

<!-- TOAST -->
<div class="toast align-items-center position-fixed top-0 end-0 m-3" id="toast" role="alert" style="z-index: 2100;">
    <div class="toast-header"><span id="toastTitle"></span></div>
    <div class="toast-body" id="toastMessage"></div>
</div>
<!-- Bootstrap JS bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="app.js"></script>
</body>
</html>
